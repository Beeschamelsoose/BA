#ifndef SAVE_H
#define SAVE_H

#include "stm32l4xx_hal.h"
#include <stdint.h>

#ifdef __cplusplus
extern "C" {
#endif

/* 12-Byte Datensatz:
 * 4B timestamp, 3B temp, 3B humidity, 2B adc(12)+state(4)
 */
#pragma pack(push,1)
typedef struct {
    uint32_t timestamp;   // 4
    int8_t   temp[3];     // 3
    int8_t   hum[3];      // 3
    uint16_t adc_state;   // 2  -> (adc12 & 0x0FFF) | ((st & 0x0F) << 12)
} DataRecord;
#pragma pack(pop)

void Save_Init(void);
HAL_StatusTypeDef Save_Append(const DataRecord *rec);
HAL_StatusTypeDef Save_Flush(void);

/* baut den Record und packt adc+status intern */
HAL_StatusTypeDef save_push_from_main_ts(int8_t t1, int8_t t2, int8_t t3,
                                         int8_t h1, int8_t h2, int8_t h3,
                                         uint16_t adc12, uint8_t st,
                                         uint8_t reserved, uint16_t ts);

#ifdef __cplusplus
}
#endif
#endif
